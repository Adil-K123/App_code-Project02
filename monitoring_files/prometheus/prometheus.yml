#A scrape configuration scraping a Node Exporter and the Prometheus server
# itself.
scrape_configs:
  # Scrape Prometheus itself every 5 seconds.
  - job_name: 'prometheus'
    scrape_interval: 5s
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'cadvisor'
    dns_sd_configs:
      - names:
          - 'tasks.cadvisor'
        type: 'A'
        port: 8080
    relabel_configs:
      - source_labels: [__meta_docker_swarm_task_node_name]
        target_label: 'node'
  
  - job_name: 'node-exporter'
    dns_sd_configs:
      - names:
          - 'tasks.node-exporter'
        type: 'A'
        port: 9100
    relabel_configs:
      - source_labels: [__meta_docker_swarm_task_node_name]
        target_label: 'node'

  - job_name: 'flask_app'
    dns_sd_configs:
      - names:
          - 'tasks.app_stack_productreview_app'
        type: 'A'
        port: 8000
    relabel_configs:
      - source_labels: [__meta_docker_swarm_task_node_name]
        target_label: 'node'

  - job_name: 'nginx-prom-exporter'
    scrape_interval: 5s
    static_configs:
      - targets: ['monitoring_stack_nginx-prometheus-exporter:9113']